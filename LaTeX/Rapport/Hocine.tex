\documentclass[10pt,a4paper]{report}

\usepackage[utf8]{inputenc}
\usepackage[french]{babel}
\usepackage[T1]{fontenc}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage{lmodern}
\usepackage{hyperref}
\usepackage{url}
\usepackage{xspace}
\usepackage{tikz}
\usepackage{listings}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{enumitem}
%\usepackage{feynmp}
%\usepackage{tikz-feynman}

\usepackage[left=2cm,right=2cm,top=2cm,bottom=2cm]{geometry}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Page de garde %%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\author{Alexia \textsc{HOCINE}}

\title{Détecteur SDHCAL pour le signal  $ e^{+} e^{-} \longrightarrow \nu \nu h $ :\\Optimisation et Adaptation de l'analyse de données\\pour le Projet FCC 
}
%Stage M2 Physique, parcours SUBA\\Université de Claude Bernard Lyon 1
\date{Juillet 2022}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Raccourçi %%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% raccourci français
\newcommand{\cad}{c'est-à-dire\xspace}
\newcommand{\qqs}{quelque soit\xspace}
\newcommand{\MS}{Modèle Standard\xspace}


% nom informatique
\newcommand{\ROOT}{\texttt{ROOT}\xspace}
\newcommand{\SLCIO}{\texttt{SLCIO}\xspace}
\newcommand{\iLCSoft}{\texttt{iLCSoft}\xspace}
\newcommand{\LCIO}{\texttt{LCIO}\xspace}
\newcommand{\Marlin}{\texttt{Marlin}\xspace}
\newcommand{\Gaudi}{\texttt{Gaudi}\xspace}
\newcommand{\FCC}{\texttt{FCC}\xspace}
\newcommand{\EDMhep}{\texttt{EDM4hep}\xspace}

\newcommand{\nnhAnalysis}{\texttt{nnhAnalysis}\xspace}

\newcommand{\original}{\texttt{original}\xspace}
\newcommand{\ilcsoft}{\texttt{ilcsoft}\xspace}
\newcommand{\fcc}{\texttt{fcc}\xspace}

\newcommand{\minidstmarker}{\texttt{miniDSTMaker}\xspace}
\newcommand{\convert}{\texttt{convert}\xspace}
\newcommand{\processor}{\texttt{processor}\xspace}
\newcommand{\analysis}{\texttt{analysis}\xspace}


% nom de particules
\newcommand{\particle}[1]{$\texttt{#1}$}

\newcommand{\bbar}{\overline{b}}
\newcommand{\Wstar}{W^{\star}}

\newcommand{\electron}{e^{+}}
\newcommand{\positron}{e^{-}}

\newcommand{\nnh}{\nu \nu h}

% processus courants
\newcommand{\bb}{$\mathrm{b\bbar}$\xspace}
\newcommand{\WW}{$\mathrm{W\Wstar}$\xspace}

% physique
\newcommand{\GeV}{\texttt{GeV}\xspace}
\newcommand{\TeV}{\texttt{TeV}\xspace}
\newcommand{\MeV}{\texttt{MeV}\xspace}

% LaTeX

\newcommand{\doToList}[1]{{\color{red}#1}}
\newcommand{\Figure}[1]{[\textsc{Figure~#1}]}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%% corps du document %%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}

\input{FirstPage.tex}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\input{start.tex}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\tableofcontents

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\input{Introduction.tex}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\input{iLCSoft.tex}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{Programme \texttt{FCC}}

\section{Présentation du Projet FCC}

Le FCC (Futur Collisionneur Circulaire) est le projet du CERN pour remplacer 
leur collisionneur actuelle, le LHC (Large Hadronic Collider). 
Dont la fin de l'exploitation est prévu en 2040 \cite{cern:fcc}.
On prévoit un anneau de 100 km, contre 27 km pour le LEP et le LHC 
(comme montrer Figure~\ref{fcc:img}).
Ce qui devrait nous permettra d'atteindre une énergie de 100 \TeV contre 13 \TeV
actuellement pour le LHC.

L'objectif est la rechercher d'une nouvelle physique par la mise en évidence de déviation avec le modèle standard. Et plus particulièrement, en augmentant la statistique sur le boson de Higgs, découvert avec le collisionneur actuelle, afin de mieux comprendre sa physique.

\begin{figure}[h!]
    \centering
    \includegraphics[width=\textwidth]{../img/FCC.jpg}
    \caption{https://cds.cern.ch/images/OPEN-PHO-ACCEL-2019-001-2}
    \label{fcc:img}
\end{figure}

Une fois encore, le détecteur SDHCAL candidate pour ce projet et pourrait être y être installer.

\section{Développement Numérique}

Mon objectif est d'adapter les codes développés précédemment par Guillaume 
\textsc{Garillot} du projet ILC au projet FCC qui n'utilise pas les mêmes suites logiciels.\\


\subsection{\convert}

Dans un premier temps, je dois convertir les fichiers \SLCIO en fichiers \ROOT en utilisant le programme libre \texttt{k4MarlinWrapper} du projet de \texttt{key4hep}\footnote{\url{https://github.com/key4hep/k4MarlinWrapper}}. 
Il s'agit d'une collaboration entre chercheurs du CERN dont l'objectif est de développer des outils pour le projet FCC, y compris des utils de conversion entre \LCIO (\iLCSoft) et \EDMhep (\FCC).%, en utilisant les algorithmes \texttt{Gaudi}
\\

Cette partie a été laborieux, car le programme \texttt{k4MarlinWrapper} est en cours de développement. 
J'ai du faire remonter de très nombreux problèmes en parallèle de mon travail. 
En effet, à chaque mise à jour, le programme ne fonctionnait plus, ce qui m'a fait perdre beaucoup de temps en essayant de comprendre le problème, le signaler et le corriger quand je le comprenais, ou patienter pour que quelqu'un d'autre le corrige. 

\subsection{\processor}

Comme les fichiers d'entrées sont à présent des fichiers \ROOT, il faut adapter cette partie pour que les fichiers de sortie soit les mêmes ou au moins équivalent.

\subsection{\analysis}

Cette partie reste inchangé par rapport à \ilcsoft.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{Outils Numériques}

Pour utiliser et comparer les résultats obtenus facilement, j'ai développé de très nombreux programmes supplémentaires afin de pouvoir automatiser leur utilisation, mais aussi de les exécuter sur un serveur distant. 

\section{Répertoire \texttt{script}}

Dans ce dossier\footnote{\url{https://github.com/alexhxia/nnhAnalysis/tree/main/script}}, j'ai développé des outils d'automatisation de l'exécution des programmes. En effet, avant pour lancer un \processor ou une \analysis il y avait de très nombreuses commandes à taper au terminal et parfois incompatible entre elles.
J'ai donc développé 6 programmes principaux d'automatisation des programmes :

\begin{description}
	
	\item[\texttt{nnh}]	programme générale qui permet l'exécution de tout le programme (\convert, \processor et \analysis) et plusieurs fois.
	\begin{description}

	\item[\texttt{nnhConvert}] permet de convertir les fichiers \SLCIO en fichiers \ROOT.
	
	\item[\texttt{nnhProcessor}] d'exécuter tout le programme \processor.
	
	\item[\texttt{nnhAnalysis}] exécute tout le programme \analysis.
	
	\begin{description}
		
		\item[\texttt{prepareBDT}] exécute la préparation de la BDT.
		
		\item[\texttt{launchBDT}] lance la BDT \footnote{Le programme \texttt{launchBDT} est incompatible avec les autres, ce qui nécessite de le lancer dans un terminal enfant.}.
		
	\end{description}
	\end{description}
	
\end{description}

Chacun de ces programmes peuvent être lancé ensemble mais aussi séparément. Ce qui permet de gagner énormément en temps d'utilisation mais aussi de pouvoir personnaliser selon les besoins de l'utilisateur.

\section{Répertoire \texttt{test}}

Pour tester les résultats obtenus, j'ai développé 4 programmes en \texttt{python}.  Et de tester s'ils sont compatibles entre eux.

\begin{figure}[h!]
	\center
	\begin{tabular}{| c | c | c |}
		\hline
			\texttt{•} & \texttt{Processus} & \texttt{Analysis} \\
		\hline
			\texttt{Completed} & \texttt{testProcessorCompleted.py} & \texttt{testAnalysisCompleted.py} \\
		\hline
			\texttt{Same} & \texttt{testProcessorSame.py} & \texttt{testAnalysisSame.py} \\
		\hline
	\end{tabular}
	\caption{Tableau récapitulatif des fonctions de tests}
\end{figure}

\subsection{Programmes \texttt{testXxCompleted.py}}

L'objectif de ce type de programme est de tester si tous les fichiers qui aurait du être créer, l'ont bien été. Ces programmes sont très rapides, ne prennent que en quelques secondes.

Ce qui permet, en cas de problèmes de relancer juste la partie qui n'est pas terminé et pas tout le programme.

\subsubsection{Programmes \texttt{testProcessorCompleted.py}}

Un \processor est complet si tous les dossiers du répertoire d'entré (\Figure{\ref{data:list}}) ont bien généré un fichier \ROOT.

\subsubsection{Programmes \texttt{testAnalysisCompleted.py}}

Une \analysis est complète si elle contient 13 fichiers, car :
\begin{description}
	\item[hadd :] 1 fichier \verb|data.root|
	\item[prepareBDT :] 4 fichiers (2 polarisations $\times$ 2 canaux) \verb|split_XX.root| 
	\item[launchBDT :] 2 fichiers (2 canaux) \verb|model_XX.joblib|, \verb|scores_XX.root|, \verb|bestSelection_XX.root|, \verb|stats_XX.json|
\end{description}

\subsection{Programmes \texttt{testXxSame.py}}

Ce type de programme\footnote{\url{https://github.com/alexhxia/nnhAnalysis/tree/main/test}
} va prendre quelques dizaines de minutes à une heure pour s'exécuter, car il va comparer tous les arbres \ROOT des différents fichiers pour s'assurer que 2 fichiers sont identiques ou au moins compatibles. Cette comparaison se ferait avec la fonction de Kolmogorov présente, là encore, dans l'API du CERN, qui compare 2 histogrammes et retourne un flottant sur leur compatibilité. Dans le chapitre \original, j'ai explicité que les programmes qui donnaient des résultats toujours identiques et ceux qui devaient avoir des résultats équivalents. 

\subsubsection{Programmes \texttt{testProcessorSame.py}}

Toutes les exécutions de \processor doivent donner des résultats identiques, surtout au sein du même projet. Et j'ai pu le confirmer en comparant plusieurs résultats obtenus de différentes exécutions. 

Et lorsque j'ai apporté des corrections au programme, quand je suis passée de \original à \ilcsoft, cela m'a permis de vérifier que mon code obtenait bien le même résultat. De même, de \ilcsoft à \fcc.

\subsubsection{Programmes \texttt{testAnalysisSame.py}}

La comparaison entre 2 exécutions du programme \analysis est plus compliquée, puisque la BDT utilise des nombres aléatoires, ce qui ne permet pas d'obtenir des résultats identiques.

Certains fichiers doivent rester identiques comme les fichiers \verb|data.root| ou \verb|split_XX.root|. Certains sont complètement différents comme les fichiers \verb|model_XX.joblib| ou \verb|bestSelection_XX.root|, car ils sont liés à l'entraînement de la BDT. Mais à la fin les fichiers \verb|stat_XX.json| doivent être statistiquement compatibles.

\subsection{Répertoire \texttt{result}}

Dans ce répertoire, je place les fichiers de sorti des programmes \texttt{test}. 
En effet, quand on exécute un programme de test, l'utilisateur a la possibilité d'obtenir les résultats sous la forme d'un fichier \texttt{JSON}. 
Ce qui permet d'en garder une trace et de ne pas refaire un test déjà effectué.\\

\subsection{Mes résultats}

Je peux donc confirmer que mes programmes s'exécutent complètement et correctement.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{Résultats Physiques}

\section{Physique du Higgs}

\subsection{Section efficace}

\paragraph{Fusion $W\Wstar$ \cite{desy}}

Comme on est à très haute énergie, on peut approximer que $ \sqrt{s} >> 2 $

\begin{equation}
	\sigma_{WW\ fusion} \longrightarrow 
		\frac{g_{HWW}^2 \, G_F^2}{32 \, \pi^3}
		\left[
			\left(1 + \frac{m_H^2}{s}\right) \log\left(\frac{s}{m_H^2}\right)
			- 2 \left(1 - \frac{m_H^2}{s}\right)
		\right]
\end{equation}

\begin{description}

	\item[$g_{HWW}$] : couplage du boson de Higgs et du boson W

	\item[$G_F$] : constante de couplage de Fermi
	
	\item[$m_H$] : masse du boson de Higgs
	
	\item[$s$]
		
\end{description}

\subsection{Nombre de Higgs attendu}

\subsection{Propriétés à Préciser}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Conclusion}

\section{Travail effectué}

\section{Résultats attendus}

\section{Au delà}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{appendix}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{Résumé du travail effectué}

\section{Bibliographie}

\paragraph{\url{https://tel.archives-ouvertes.fr/tel-03405418}}
\begin{itemize}
	\item Étude du calorilmètre hadronique semi-digital et étude du canal physique 
	$$ \positron \electron \longrightarrow \nnh \ (H \longrightarrow WW \longrightarrow qqqq)$$ 
	au collisionneur circulaire électron positon (CEPC) 
	\item Bing Liu, IP2I
	\item 2020
\end{itemize}

\paragraph{\url{https://tel.archives-ouvertes.fr/tel-02141420}}
\begin{itemize}
	\item Étude des gerbes hadroniques dans un calorimètre à grande granularité et étude du canal $$ \positron \electron \longrightarrow HZ \ (Z \longrightarrow qq) $$ dans les futurs collisionneurs leptoniques
	\item Guillaume Garillot, IPNL
	\item 2019
\end{itemize}

\section{Tutoriels}

\begin{description}
	\item[\texttt{LCIO}] \url{https://github.com/iLCSoft/LCIO}
	\item[\texttt{ILDConfig}] \url{https://github.com/iLCSoft/ILDConfig}
	\item[\texttt{Marlin}] \url{https://github.com/iLCSoft/Marlin}
	\item[\texttt{key4hep}] \url{https://github.com/key4hep/k4MarlinWrapper}
\end{description}

\section{Code initial}

\url{https://github.com/ggarillot/nnhAnalysis/tree/refactor}

\section{Code final}

\url{https://github.com/alexhxia/nnhAnalysis}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{Organisation du Projet}

\section{Organisation initiale}

\input{figure/tikz/orgaInit.tex}

\section{Organisation finale}

\input{figure/tikz/orgaFinal.tex}

\section{Le dossier \texttt{NNH\_HOME}}

Pour s'exécuter, le projet a besoin de la variable d'environnement \texttt{NNH\_HOME} qui est le chemin du programme que vous souhaitez exécuter,  mis en avant en rouge dans les Figure~\ref{orga:begin} et Figure~\ref{orga:end}.

Donc dans le projet initial, il s'agissait de \texttt{NNH\_HOME=$\backslash$nnhAnalysis} et dans le nouveau projet :
\begin{itemize}
	\item \texttt{NNH\_HOME = $\backslash$nnhAnalysis$\backslash$nnhProgram$\backslash$original}
	\item \texttt{NNH\_HOME = $\backslash$nnhAnalysis$\backslash$nnhProgram$\backslash$ilcsoft}
	\item \texttt{NNH\_HOME = $\backslash$nnhAnalysis$\backslash$nnhProgram$\backslash$fcc}
\end{itemize}


\chapter{Fichiers \ROOT de sorties du programme \processor}

On a vu précédemment que \processor converti une série de fichier \SLCIO en fichiers \ROOT. 

Il considère deux canaux de désintégration du Higgs :
\begin{align}
	& h \longrightarrow b \bbar \label{eq:bbar}\\
	& h \longrightarrow W \Wstar \longrightarrow qqqq \label{eq:WWstar}
\end{align}

La première équation (\ref{eq:bbar}) sera mesuré par le détecteur sous la forme de 2 jets reconstruit et identifié comme 2 quark \particle{b}.

Alors que la seconde équation (\ref{eq:WWstar}) sera reconstruit comme 4 jets, 2 par boson \particle{W}\footnote{\particle{W} sur couche de masse, \particle{Wstar} hors couche de masse}.

\end{appendix}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Figure %%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\listoffigures

%%%%%%%%%%%%%%%%%%%%%%%%%%%%% BIBLIO %%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\bibliographystyle{plain} %{Nabbrv}
%\bibliography{../Bibliographies/biblio}

%\printbibheading


%\nocite{*} % Afficher toute la biblio

\bibliographystyle{plain} %{Nabbrv}
\bibliography{biblio}
%\printbibliography[keyword = {sdhcal}, title = {SDHCAL}]
%\printbibliography[keyword = {ilcsoft}, title = {iLCSoft}]
%\printbibliography[keyword = {fcc}, title = {FCC}]
%\printbibliography[keyword = {particles}, title = {Physique des Particules}]


\end{document}
